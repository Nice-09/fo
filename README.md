# 思维导图 Flutter 应用

这是一个功能完整的Flutter思维导图应用，将原有的H5思维导图转换为移动端原生应用。

## 功能特性

### 核心功能
- ✅ **节点管理**：添加、删除、编辑节点
- ✅ **自动布局**：智能树形布局算法，自动排列节点
- ✅ **拖拽交互**：支持节点拖拽和画布平移
- ✅ **缩放功能**：双指缩放或滚轮缩放
- ✅ **展开/折叠**：支持节点的展开和折叠
- ✅ **撤销功能**：支持操作撤销（最多50步）
- ✅ **本地存储**：自动保存数据到本地
- ✅ **PDF导出**：导出思维导图为PDF文件

### 设计风格
- 飞书风格设计
- 蓝色根节点，白色子节点
- 左边框颜色编码（蓝色、蓝绿、绿色、黄色、红色、紫色）
- 简洁现代的UI界面

## 技术栈

- **框架**: Flutter 3.0+
- **状态管理**: Provider
- **本地存储**: SharedPreferences
- **PDF导出**: pdf package
- **向量计算**: vector_math
- **文件操作**: path_provider, open_file

## 项目结构

```
mindmap_flutter/
├── lib/
│   ├── main.dart                    # 应用入口
│   ├── models/
│   │   ├── node.dart                # 节点数据模型
│   │   └── connection.dart          # 连接数据模型
│   ├── providers/
│   │   └── app_state.dart           # 状态管理（撤销/重做）
│   ├── screens/
│   │   └── mindmap_screen.dart      # 主屏幕
│   ├── widgets/
│   │   └── mind_map_painter.dart    # 自定义画布渲染
│   └── services/
│       ├── layout_service.dart      # 自动布局服务
│       └── pdf_service.dart         # PDF导出服务
├── pubspec.yaml                     # 项目配置
└── README.md                        # 项目说明
```

## 安装和运行

### 前置要求
- Flutter SDK 3.0+
- Dart SDK 3.0+
- Android Studio / Xcode（用于移动端开发）

### 安装步骤

1. 克隆或下载项目到本地

2. 进入项目目录
```bash
cd D:\code\mindmap_flutter
```

3. 安装依赖
```bash
flutter pub get
```

4. 运行应用
```bash
flutter run
```

### 运行在特定设备

- Android模拟器或真机：
```bash
flutter run -d android
```

- iOS模拟器（仅Mac）：
```bash
flutter run -d ios
```

- Chrome浏览器（Web）：
```bash
flutter run -d chrome
```

## 使用说明

### 基本操作

1. **添加子节点**
   - 点击选择一个节点
   - 点击工具栏的"添加子节点"按钮
   - 新节点会自动添加到选中节点的下方

2. **删除节点**
   - 点击选择要删除的节点
   - 点击工具栏的"删除节点"按钮
   - 根节点不能被删除

3. **拖拽节点**
   - 长按节点并拖动
   - 节点会跟随鼠标/手指移动

4. **平移画布**
   - 在空白区域拖动
   - 画布会跟随移动

5. **缩放画布**
   - 使用双指捏合（移动端）
   - 或使用鼠标滚轮（桌面端）

6. **展开/折叠**
   - 点击节点左侧的圆形按钮
   - 展开显示子节点，折叠隐藏子节点

7. **撤销操作**
   - 点击工具栏的"撤销"按钮
   - 可以撤销最多50步操作

8. **保存数据**
   - 点击工具栏的"保存"按钮
   - 数据会自动保存到本地

9. **导出PDF**
   - 点击工具栏的"导出PDF"按钮
   - PDF文件会保存到设备文档目录

10. **重置视图**
    - 点击右下角的浮动按钮
    - 视图会重置为初始状态

### 节点层级颜色

- **Level 0**（根节点）：蓝色
- **Level 1**：蓝绿色
- **Level 2**：绿色
- **Level 3**：黄色
- **Level 4**：红色
- **Level 5**：紫色

## 数据存储

应用使用SharedPreferences进行本地存储，数据存储键为 `mindmap_data`。

存储内容包括：
- 所有节点信息
- 所有连接信息
- 节点ID计数器

## 注意事项

1. **首次运行**：应用会自动创建一个根节点"中心主题"
2. **自动保存**：每次操作后建议点击"保存"按钮
3. **撤销限制**：最多支持50步撤销
4. **PDF导出**：需要设备支持文件存储权限

## 故障排除

### 依赖安装失败
```bash
flutter clean
flutter pub get
```

### 构建失败
```bash
flutter upgrade
flutter pub upgrade
```

### 运行时错误
- 确保Flutter环境配置正确
- 检查设备是否已连接
- 查看详细错误日志

## 未来改进

- [ ] 添加节点编辑功能（双击编辑文字）
- [ ] 支持更多布局样式（横向、径向等）
- [ ] 添加主题切换功能
- [ ] 支持导入/导出其他格式（JSON、XML等）
- [ ] 添加协作功能
- [ ] 支持图片和附件
- [ ] 添加更多自定义样式选项

## 许可证

MIT License

## 联系方式

如有问题或建议，请通过以下方式联系：
- 提交Issue
- 发送邮件

---

**祝使用愉快！** 🎉